<?xml version="1.0"?>
<project name="diary" default="echo" basedir=".">

    <property name="src.dir" location="src"/>
    <property name="lib.dir" location="lib"/>
    <property name="build.dir" location="build"/>
    <property name="build.classes.dir" location="${build.dir}/classes"/>
    <property name="dist.dir" location="dist"/>

    <property name="metadata.dir" location="metadata"/>
    <property name="buildprops.file" location="${metadata.dir}/build.properties"/>
    <property name="buildnum.file" location="${metadata.dir}/build.number"/>

    <path id="compile.classpath">
        <fileset dir="${lib.dir}">
            <include name="*.jar"/>
        </fileset>
    </path>

    <target name="compile" description="no no no 333" depends="init">
        <condition property="build.debuglevel"
                   value="lines,source"
                   else="lines,vars,source">
            <isset property="release.build"/>
        </condition>

        <depend srcdir="src"
                destdir="${build.classes.dir}"
                cache="${build.dir}/dependencies"
                closure="true">
            <classpath refid="compile.classpath"/>
        </depend>
        <javac destdir="${build.classes.dir}"
               debug="true"
               debuglevel="${build.debuglevel}"
               includeAntRuntime="false"
               srcdir="src">
            <classpath refid="compile.classpath"/>
        </javac>
    </target>

    <target name="echo2" description="no no no 222" depends="init">
        <!-- Increments a build counter -->
        <buildnumber file="${buildnum.file}"/>

        <echo message="Build Number: ${build.number}"/>
        <delete file="${buildprops.file}"/>
        <propertyfile comment="Build Information" file="${buildprops.file}">
            <entry key="build.number" value="${build.number}"/>
            <entry key="expiration.date"
                   type="date"
                   operation="+"
                   value="1"
                   default="now"
                   unit="month"/>
        </propertyfile>
    </target>

    <target name="echo" description="no no no" depends="init">
        <property name="source.files.tocopy" value="**/*.properties"/>
        <copy todir="${build.classes.dir}">
            <fileset dir="${basedir}" includes="${source.files.tocopy}"/>
        </copy>

        <property environment="env"/>
        <property name="env.COMPUTERNAME" value="${env.HOSTNAME}"/>
        <propertyfile comment="Build Information" file="${build.classes.dir}/build.properties">
            <entry key="build.date"
                   type="date"
                   pattern="EEEE MMM dd, yyyy"
                   value="now"/>
            <entry key="build.time"
                   type="date"
                   pattern="kk:mm:ss"
                   value="now"/>
            <entry key="build.host" value="${env.COMPUTERNAME}"/>
            <entry key="build.user.name" value="${user.name}"/>
            <entry key="build.os.name" value="${os.name}"/>
            <entry key="build.os.arch" value="${os.arch}"/>
        </propertyfile>
    </target>

    <target name="init">
        <mkdir dir="${build.classes.dir}"/>
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="${metadata.dir}"/>
    </target>

    <target name="diagnostics" description="diagnostics">
        <diagnostics/>
    </target>

    <target name="clean" description="Deletes files generated by the build.">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
        <delete dir="${metadata.dir}"/>
    </target>

</project>